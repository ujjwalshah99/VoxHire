# AI Interview Platform - Complete Backend Implementation Guide

## Overview
This guide describes the complete backend implementation for the AI Interview Platform, including all database tables, API endpoints, and business logic required for full functionality.

## Architecture

### Database Schema
The platform uses Supabase (PostgreSQL) with the following tables:

#### Core Tables

### 1. Users
- Stores user authentication info, credits, and subscription data
- Connected to Supabase Auth
- Fields: id, name, email, credits, subscription_tier, subscription_expires_at

### 2. UserProfiles  
- Stores extended user profile data
- Fields: userEmail, bio, skills, achievements, preferences, avatar_url, social links

### 3. Interviews
- Stores interview metadata (job position, questions, status, scheduling, etc.)
- Fields: interview_id, userEmail, jobPosition, questionList, status, scheduled_for, timezone, etc.

### 4. InterviewAnalytics
- Stores overall analytics (score, feedback summary, strengths, improvements)
- Generated by Gemini AI after interview completion

### 5. **Enhanced PerformanceAnalytics** ‚≠ê
- **SIGNIFICANTLY ENHANCED** for detailed AI-powered performance analysis
- Stores questions, answers, and comprehensive performance metrics
- **NEW FEATURES:**
  - **Individual Skill Scores:** technical_score, communication_score, problem_solving_score, confidence_score
  - **Detailed AI Feedback:** strengths (jsonb), improvements (jsonb), ai_recommendation (text)
  - **Question-Level Analysis:** question_scores (jsonb), response_quality (jsonb), time_taken (jsonb)
  - **Performance Metrics:** total_questions, questions_answered, average_response_time
- Powers the enhanced analytics dashboard with real performance insights

### 6. PracticeSessions
- Stores practice mode session data
- Fields: session_id, userEmail, category, difficulty, questions, responses, score, feedback

### 7. UserSessions
- Tracks user activity and session data
- Used for analytics and progress tracking

## Complete API Endpoints

### Core Interview System

#### `/api/interview`
- GET: Fetch interview by ID
- POST: Create new interview with AI-generated questions
- PUT: Update interview status, feedback, or scheduling
- DELETE: Delete interview and all related data

#### `/api/ai-model`
- POST: Generate interview questions using Gemini AI
- Supports multiple question types and difficulty levels

### Analytics & Performance

#### `/api/analytics` ‚≠ê **ENHANCED**
- **GET**: Fetch comprehensive user analytics with:
  - **Real skill breakdown** calculated from actual performance data
  - **Improvement trends** based on historical performance analysis
  - **Detailed interview performance** including AI-generated feedback
  - **Enhanced recent performance** with complete modal data for frontend
- **POST**: Save AI-generated analytics with comprehensive analysis:
  - **Multi-dimensional scoring** (technical, communication, problem-solving, confidence)
  - **Detailed AI feedback** (strengths, improvements, personalized recommendations)
  - **Question-level analysis** (individual scores, quality assessment, timing)
  - **Advanced AI integration** with structured prompt engineering

#### `/api/performance-analytics` ‚≠ê **ENHANCED**
- **GET**: 
  - Fetch detailed questions/answers for an interview
  - **NEW**: Get comprehensive performance analytics with interview details (`?detailed=true`)
  - **NEW**: Get all user performance analytics (`?userEmail=email&detailed=true`)
- **POST**: Save enhanced performance data with:
  - Individual skill scores (technical, communication, problem-solving, confidence)
  - Detailed AI feedback (strengths, improvements, recommendations)
  - Question-level analysis (scores, quality assessment, timing)
  - Performance metrics (completion rates, response times)

#### `/api/user-stats`
- GET: Get comprehensive user statistics
- Includes totals, averages, streaks, and improvement metrics

### Practice Mode System

#### `/api/practice-session`
- GET: Fetch user practice sessions or specific session
- POST: Save practice session with AI evaluation
- Supports multiple categories and difficulty levels

### User Management

#### `/api/profile`
- GET: Fetch comprehensive user profile
- PUT: Update user profile data
- POST: Handle profile actions (add/remove skills, unlock achievements)

### Scheduling System

#### `/api/schedule`
- GET: Fetch scheduled interviews with filtering options
- POST: Schedule new interview with timezone support
- PUT: Reschedule, cancel, or mark interviews complete

### Billing & Subscription

#### `/api/billing`
- GET: Fetch billing info and subscription details
- POST: Handle subscription updates, credit purchases, usage tracking

### Response Evaluation

#### `/api/responses`
- GET: Fetch responses for an interview (backward compatibility)
- POST: Save and evaluate individual responses with AI feedback

## Key Features Implemented

### üéØ Core Interview System
- ‚úÖ Interview creation with AI-generated questions
- ‚úÖ Interview management (CRUD operations)
- ‚úÖ Question generation using Gemini AI
- ‚úÖ Real-time interview processing with VAPI
- ‚úÖ Interview scheduling and calendar management
- ‚úÖ Interview analytics and performance tracking

### üèãÔ∏è Practice Mode System
- ‚úÖ Multiple practice categories (technical, behavioral, etc.)
- ‚úÖ Difficulty levels (beginner, intermediate, advanced)
- ‚úÖ AI-powered feedback and scoring
- ‚úÖ Practice session analytics
- ‚úÖ Progress tracking across sessions

### üìä Analytics & Reporting
- ‚úÖ Comprehensive user performance analytics
- ‚úÖ Skill breakdown analysis
- ‚úÖ Improvement trend tracking
- ‚úÖ Interview and practice session statistics
- ‚úÖ AI-generated feedback and recommendations

### üë§ User Management
- ‚úÖ User profiles with bio and skills
- ‚úÖ Achievement system
- ‚úÖ User preferences and settings
- ‚úÖ Activity tracking and streaks

### üí∞ Billing & Subscription
- ‚úÖ Multiple subscription tiers (Free, Pro, Enterprise)
- ‚úÖ Credit-based usage system
- ‚úÖ Usage tracking and limits
- ‚úÖ Plan feature management

### üìÖ Scheduling System
- ‚úÖ Interview scheduling and rescheduling
- ‚úÖ Calendar integration
- ‚úÖ Reminder system (framework ready)
- ‚úÖ Timezone support

## Implementation Flow

### Interview Creation Flow
1. User creates interview via `/api/interview` POST
2. AI generates questions via `/api/ai-model` POST
3. Interview is stored with generated questions
4. User can schedule via `/api/schedule` POST (optional)
5. Interview link is generated for sharing

### Interview Execution Flow
1. Candidate accesses interview via public link
2. Real-time conversation handled by VAPI integration
3. Responses are saved via `/api/responses` POST
4. AI evaluates each response in real-time
5. Complete session data stored in PerformanceAnalytics

### Analytics Generation Flow
1. After interview completion, call `/api/analytics` POST
2. Gemini AI analyzes complete conversation
3. Overall score, feedback, strengths/improvements generated
4. Data stored in InterviewAnalytics table
5. User can view via analytics dashboard

### Practice Mode Flow
1. User selects practice category and difficulty
2. Questions generated from predefined sets
3. User completes practice session
4. AI evaluates performance via `/api/practice-session` POST
5. Score and feedback provided immediately
6. Session data stored for progress tracking

## Database Functions

### Custom PostgreSQL Functions
- `update_user_credits(user_email, credit_change)` - Safely update user credits
- `get_user_stats(user_email)` - Efficiently calculate user statistics

## Security & Permissions

### Row Level Security (RLS)
- All tables have RLS enabled
- Users can only access their own data
- Policies enforce email-based access control

### API Security
- All APIs validate user permissions
- Input validation and sanitization
- Error handling and logging

## Frontend Integration

### Components That Use Backend
- **Dashboard**: `/api/user-stats`, `/api/analytics`
- **Create Interview**: `/api/ai-model`, `/api/interview`
- **Analytics Page**: `/api/analytics`, `/api/performance-analytics`
- **Profile Page**: `/api/profile`, `/api/user-stats`
- **Practice Mode**: `/api/practice-session`
- **Schedule Page**: `/api/schedule`
- **Billing Page**: `/api/billing`

### Real-time Features
- VAPI integration for voice interviews
- Real-time response evaluation
- Live feedback during interviews

## AI Integration

### Gemini AI Usage
1. **Question Generation**: Analyzes job descriptions to create relevant questions
2. **Response Evaluation**: Scores individual responses and provides feedback
3. **Session Analysis**: Generates comprehensive interview analytics
4. **Practice Feedback**: Evaluates practice sessions and provides improvement suggestions

### AI Prompts Optimized For
- Different question types (technical, behavioral, etc.)
- Various difficulty levels
- Industry-specific requirements
- Scoring consistency and accuracy

## Deployment Considerations

### Environment Variables Required
```
GEMINI_API_KEY=your_gemini_api_key
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
NEXT_PUBLIC_VAPI_API_KEY=your_vapi_api_key
```

### Database Setup
1. Run the complete `database-schema.sql` script
2. Set up RLS policies
3. Create database functions
4. Configure authentication

### Performance Optimizations
- Database indexes on frequently queried fields
- Efficient SQL queries with proper JOINs
- Caching strategies for static data
- Optimized AI model calls

## Testing & Monitoring

### API Testing
- Comprehensive test coverage for all endpoints
- Edge case handling
- Error response validation
- Performance benchmarking

### Monitoring
- API response times
- Database query performance
- AI model usage and costs
- User activity patterns

## Future Enhancements

### Ready for Implementation
- Email/SMS reminder system
- Stripe payment integration
- Advanced reporting dashboard
- Team management features
- Mobile app API support
- Webhook integrations

This backend implementation provides a robust, scalable foundation for the AI Interview Platform with comprehensive functionality across all user-facing features.
